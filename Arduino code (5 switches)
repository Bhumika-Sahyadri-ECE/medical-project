#include <DFRobotDFPlayerMini.h>
#include <SoftwareSerial.h>

SoftwareSerial mySerial(10, 11); // RX, TX
DFRobotDFPlayerMini myDFPlayer;

const int b1 = 2, b2 = 3, b3 = 7, b4 = 8;

void setup() {
  Serial.begin(9600);
  mySerial.begin(9600);

  Serial.println(F("Initializing DFPlayer..."));

  if (!myDFPlayer.begin(mySerial)) {
    Serial.println(F("Unable to begin:"));
    Serial.println(F("1. Please recheck connections"));
    Serial.println(F("2. Insert SD card with valid files"));
    while (true); 
  }

  Serial.println(F("DFPlayer Mini online."));

  // Check how many files
  int fileCount = myDFPlayer.readFileCounts();
  Serial.print(F("Files on SD card: "));
  Serial.println(fileCount);

  // Set volume (0â€“30)
  myDFPlayer.volume(30);
  Serial.print(F("Volume set to: "));
  Serial.println(myDFPlayer.readVolume());

  // Setup buttons with internal pull-up resistors
  pinMode(b1, INPUT_PULLUP);
  pinMode(b2, INPUT_PULLUP);
  pinMode(b3, INPUT_PULLUP);
  pinMode(b4, INPUT_PULLUP);
}

void loop() {
  if (digitalRead(b1) == LOW) {
    myDFPlayer.play(5); 
    delay(500);         
  }

  if (digitalRead(b2) == LOW) {
    myDFPlayer.play(8); 
    delay(500);
  }

  if (digitalRead(b3) == LOW) {
    myDFPlayer.play(1); 
    delay(500);
  }

  if (digitalRead(b4) == LOW) {
    myDFPlayer.play(2); 
    delay(500);
  }

  // --- DFPlayer status/error handling ---
  if (myDFPlayer.available()) {
    uint8_t type = myDFPlayer.readType();
    int value = myDFPlayer.read();

    switch (type) {
      case DFPlayerPlayFinished:
        Serial.print(F("Track finished: "));
        Serial.println(value);
        break;

      case DFPlayerError:
        Serial.print(F("Error: "));
        switch (value) {
          case Busy: Serial.println(F("Card not found")); break;
          case Sleeping: Serial.println(F("Player sleeping")); break;
          case SerialWrongStack: Serial.println(F("Wrong stack")); break;
          case CheckSumNotMatch: Serial.println(F("Checksum mismatch")); break;
          case FileIndexOut: Serial.println(F("File index out of range")); break;
          case FileMismatch: Serial.println(F("Cannot find file")); break;
          case Advertise: Serial.println(F("In advertise mode")); break;
          default: Serial.println(F("Unknown error")); break;
        }
        break;

      default:
        break;
    }
  }
}
